---
export interface Props {
  cv?: string;
  foto?: string;
}
const { cv, foto } = Astro.props;

const BASE = (import.meta.env.BASE_URL || "/").replace(/\/+$/, "");
const cvUrl = cv
  ? (/^https?:\/\//i.test(cv) ? cv : `${BASE}${cv.startsWith("/") ? cv : `/${cv}`}`)
  : `${BASE}/files/CV.pdf`;
const fotoUrl = foto
  ? (/^https?:\/\//i.test(foto) ? foto : `${BASE}${foto.startsWith("/") ? foto : `/${foto}`}`)
  : `${BASE}/assets/foto-hero.jpeg`;
---

<section id="inicio" class="hero hero-stage" aria-label="Presentación">
  <div class="container hero-stage-grid">
    <!-- Panel sticky, centrado. SIN animaciones de entrada -->
    <div class="stage-panel">
      <div class="intro">
        <h1 class="hero-title">
          Sebastián Vedoya M.
          <span class="hero-sub">Comunicación Estratégica</span>
        </h1>
        <p class="lead hero-lead">
          Estratega en comunicación con más de 10 años de experiencia en medios y gobierno.
          Me dedico a buscar respuestas complejas para entornos complejos.
        </p>
      </div>

      <!-- Foto: aparece pronto con el scroll -->
      <div class="photo-float" id="heroPhoto">
        <img src={fotoUrl} alt="Sebastián Vedoya M." loading="lazy" />
      </div>

      <!-- Contactos: aparecen poco después -->
      <div class="cta-row cta-hidden" id="heroContact">
        <a class="btn btn-outline" href={cvUrl} download>Descargar CV</a>
        <a class="chip" href="mailto:seba.vedoya@gmail.com">seba.vedoya@gmail.com</a>
        <a class="chip" href="https://www.linkedin.com/in/sebastianvedoyam/" target="_blank" rel="noopener">LinkedIn</a>
      </div>
    </div>

    <!-- Triggers más cortos para disparar temprano -->
    <div class="stage-triggers" aria-hidden="true">
      <div class="trigger" id="trgPhoto"></div>
      <div class="trigger" id="trgContact"></div>
    </div>
  </div>

  <!-- (Eliminado canvas/animación del fondo) -->

  <script is:inline>
    // Foto: aparecer muy pronto
    const elPhoto   = document.getElementById('heroPhoto');
    const elContact = document.getElementById('heroContact');

    new IntersectionObserver((es)=>{
      for (const e of es) elPhoto.classList.toggle('is-on', e.isIntersecting);
    }, { rootMargin: '-5% 0% -90% 0%', threshold: 0.01 })
      .observe(document.getElementById('trgPhoto'));

    // Contacto: aparece poco después, también temprano
    new IntersectionObserver((es)=>{
      for (const e of es) elContact.classList.toggle('is-on', e.isIntersecting);
    }, { rootMargin: '-5% 0% -88% 0%', threshold: 0.01 })
      .observe(document.getElementById('trgContact'));

    // En pantallas muy bajas, muéstralos sin esperar tanto scroll
    if (window.innerHeight < 720) {
      elPhoto.classList.add('is-on');
      // dale un pequeño respiro a la foto
      setTimeout(()=> elContact.classList.add('is-on'), 120);
    }
  </script>
</section>

<style>
  /* Hero centrado y ordenado */
  .hero-stage{ min-height:110vh; position:relative; }
  .hero-stage-grid{ display:grid; grid-template-columns:1fr; }

  .stage-panel{
    position:sticky; top:14vh;
    display:flex; flex-direction:column; align-items:center; text-align:center;
    padding: 10vh 0 8vh;
  }
  .intro{ max-width: 64ch; margin: 0 auto; }
  .hero-title{ margin:0 0 .6rem; }
  .hero-title .hero-sub{ display:block; margin-top:.15rem; color:var(--copper); }
  .hero-lead{ margin: .5rem auto 0; }

  /* Foto: sin animación inicial, solo transición sutil */
  .photo-float{
    margin-top: 1.2rem;
    opacity:0; transform: translateY(8px);
    transition: opacity .28s ease, transform .28s ease;
    filter: drop-shadow(0 16px 32px rgba(0,0,0,.45));
  }
  .photo-float.is-on{ opacity:1; transform:none }
  .photo-float img{
    width:360px; height:460px; object-fit:cover; object-position:center top;
    border-radius:16px; border:4px solid #0f1720; box-shadow:0 10px 32px rgba(0,0,0,.55);
  }

  /* Contactos: igual de rápido */
  .cta-hidden{
    opacity:0; transform: translateY(6px);
    transition: opacity .25s ease, transform .25s ease;
    margin-top:.9rem;
  }
  .cta-hidden.is-on{ opacity:1; transform:none }

  /* Triggers MUY cortos para disparo temprano */
  .stage-triggers{ height:34vh }
  .stage-triggers .trigger{ height:17vh }

  @media (max-width:1040px){
    .photo-float img{ width:320px; height:420px }
  }
  @media (max-width:640px){
    .photo-float img{ width:280px; height:360px }
  }
</style>