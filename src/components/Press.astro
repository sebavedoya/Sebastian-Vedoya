---
/** ✅ Press.astro robusto para GitHub Pages
    - Rutas locales prefijadas con BASE_URL
    - Acepta http(s)
    - Placeholder si no hay imagen
    - Modo DEBUG para ver el src final en pantalla
*/

// ⚙️ Activa temporalmente para ver las rutas calculadas bajo cada card:
const DEBUG = false;

const notas = [
  {
    medio: "La Tercera",
    titulo: "Operación Topógrafo — Espionaje del Ejército a denunciantes",
    url: "https://www.latercera.com/reportajes/noticia/operacion-topografo-espionaje-del-ejercito-cuatro-denunciantes-irregularidades/777342/",
    img: "/assets/prensa/topografo.jpg",
  },
  {
    medio: "Publimetro",
    titulo: "Ricardo Lagos: “Durante mi gobierno no privaticé nada, al contrario”",
    url: "https://www.publimetro.cl/cl/noticias/2016/11/18/ex-presidente-lagos-durante-mi-gobierno-no-privatice-nada-contrario.html",
    img: "/assets/prensa/lagos.jpg",
  },
  {
    medio: "Publimetro",
    titulo: "Sebastián Piñera: “Me siento orgulloso de lo que he logrado en la vida”",
    url: "https://www.publimetro.cl/cl/noticias/2017/06/19/sebastian-pinera-me-siento-orgulloso-lo-he-logrado-vida.html",
    img: "/assets/prensa/pinera.jpg",
  },
  {
    medio: "La Tercera",
    titulo: "Hernán Larraín: “No somos partidarios de indultar a violadores de DD.HH. ni asesinos en serie”",
    url: "https://www.latercera.com/nacional/noticia/hernan-larrain-ministro-justicia-derechos-humanos-no-somos-partidarios-indultar-violadores-dd-hh-asesinos-serie/111533/",
    img: "/assets/prensa/larrain.jpg",
  },
  {
    medio: "La Tercera",
    titulo: "La declaración de ‘Ramiro’ ante Carroza",
    url: "https://www.latercera.com/la-tercera-pm/noticia/la-declaracion-ramiro-carroza-estoy-seguro-estaba-privado-libertad-detencion-preventiva/792779/",
    img: "/assets/prensa/ramiro.jpg",
  },
  {
    medio: "La Tercera",
    titulo: "El Papa en La Araucanía: 'Mari Mari, peñi, lamngen'",
    url: "https://www.latercera.com/noticia/papa-la-araucania-mari-mari/",
    img: "/assets/prensa/papa.jpg",
  },
];

// Prefijo del sitio: "/" en dev, "/Sebastian-Vedoya" en Pages
const BASE = (import.meta.env.BASE_URL || "/").replace(/\/+$/, "");

// Resolver src final
const srcFor = (p?: string) => {
  if (!p) return undefined;
  if (/^https?:\/\//i.test(p)) return p;
  return `${BASE}${p.startsWith("/") ? p : `/${p}`}`;
};
---

<section id="prensa" class="section">
  <div class="container">
    <h2>Artículos en Prensa</h2>
    <div class="grid cards">
      {notas.map((n) => {
        const src = srcFor(n.img);
        return (
          <a class="card press" href={n.url} target="_blank" rel="noopener">
            {src ? (
              <figure class="thumb">
                <img src={src} alt={n.titulo} loading="lazy" />
              </figure>
            ) : (
              <div class="thumb placeholder" aria-hidden="true"></div>
            )}
            <div class="meta">
              <span class="tag">{n.medio}</span>
              <h3 class="h5">{n.titulo}</h3>
              {DEBUG && <code class="debug-src">{src}</code>}
            </div>
          </a>
        );
      })}
    </div>
  </div>
</section>

<style>
  .press .thumb{aspect-ratio:16/9;overflow:hidden;border-radius:.6rem;margin-bottom:.5rem;background:#f1f5f9}
  .press .thumb.placeholder{display:block}
  .press img{width:100%;height:100%;object-fit:cover;display:block}
  .press .tag{font-size:.85rem;color:#5b6b7a}
  .press .meta h3{font-size:1rem;color:var(--ink);margin:.25rem 0 0;line-height:1.4}
  .debug-src{display:block;margin-top:.35rem;color:#475569;font-size:.8rem;word-break:break-all}
</style>