---
/** Reflexiones: bloques largos, staged reveal muy temprano */
const reflections = [
  {
    id: "ref-ashby",
    title: "La ley de la variedad requerida y el desafío comunicacional contemporáneo",
    body: `La ley de la variedad requerida, postulada por Ross Ashby en 1958...`
  },
  {
    id: "ref-autoridades",
    title: "Autoridades y redes sociales: una confusión frecuente",
    body: `Pese a lo que muchas autoridades creen, las redes sociales institucional no son su canal de noticias 24/7...`
  },
  {
    id: "ref-miedo",
    title: "Comunicar sin miedo",
    body: `Durante una visita a Rapa Nui tuve la oportunidad de entrevistar a la alcaldesa Elizabeth Arévalo Pakarati...`
  }
];
---

<section id="reflexiones" class="section">
  <div class="container">
    <h2 class="h2">Reflexiones</h2>

    <div class="stack">
      {reflections.map((r, i) => (
        <article class="card stage-item" data-stage={i+1} id={r.id}>
          <h3 class="h3" style="margin:0 0 .35rem">{r.title}</h3>
          <p class="prose" style="white-space:pre-wrap">{r.body}</p>
        </article>
      ))}
    </div>
  </div>

  <script is:inline>
    (function(){
      const section = document.getElementById('reflexiones');
      const items   = section.querySelectorAll('.stage-item');
      const base = Math.min(window.innerHeight * 0.10, 100);
      const thresholds = Array.from(items).map((_,i)=> (i*100) + Math.max(20, base*0.6));

      function onScroll(){
        const top = section.getBoundingClientRect().top + window.scrollY;
        const y   = window.scrollY || 0;
        items.forEach((el, i)=>{
          if (y > top - 20 + thresholds[i]) el.classList.add('is-on');
          else el.classList.remove('is-on');
        });
      }
      onScroll();
      window.addEventListener('scroll', onScroll, { passive:true });
      window.addEventListener('resize', onScroll);
    })();
  </script>
</section>