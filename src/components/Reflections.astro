---
/** Reflexiones: bloques largos con aparición inmediata */
const reflections = [
  {
    id: "ref-ashby",
    title: "La ley de la variedad requerida y el desafío comunicacional contemporáneo",
    body: `La ley de la variedad requerida, postulada por Ross Ashby en 1958...`
  },
  {
    id: "ref-autoridades",
    title: "Autoridades y redes sociales: una confusión frecuente",
    body: `Pese a lo que muchas autoridades creen, las redes sociales institucional no son su canal de noticias 24/7...`
  },
  {
    id: "ref-miedo",
    title: "Comunicar sin miedo",
    body: `Durante una visita a Rapa Nui tuve la oportunidad de entrevistar a la alcaldesa Elizabeth Arévalo Pakarati...`
  }
];
---

<section id="reflexiones" class="section reveal">
  <div class="container">
    <h2 class="h2">Reflexiones</h2>

    <div class="stack">
      {reflections.map((r, i) => (
        <article class="card stage-item" data-stage={i+1} id={r.id}>
          <h3 class="h3" style="margin:0 0 .35rem">{r.title}</h3>
          <p class="prose" style="white-space:pre-wrap">{r.body}</p>
        </article>
      ))}
    </div>
  </div>

  <script is:inline>
    (function(){
      const section = document.currentScript.closest('section');
      const items = section.querySelectorAll('.stage-item');
      const TRIGGER_OFFSET = 10; // dispara casi inmediato
      function onScroll(){
        const y = window.scrollY || document.documentElement.scrollTop || 0;
        const top = section.offsetTop;
        if (y + window.innerHeight > top + TRIGGER_OFFSET) {
          items.forEach(el => el.classList.add('is-on'));
          window.removeEventListener('scroll', onScroll);
        }
      }
      onScroll();
      window.addEventListener('scroll', onScroll, { passive:true });
    })();
  </script>
</section>