---
// Experience.astro — Carrusel de logos (solo logos, grandes y alineados)

const BASE = (import.meta.env.BASE_URL || "/").replace(/\/+$/, "");

// Agrega aquí tus archivos (a color) en src/assets/experiencia/
// Nota: el ?v=4 fuerza refresco del caché si ya existían
const logos = [
  { alt: "La Tercera",               src: `${BASE}/assets/experiencia/latercera.png?v=4` },
  { alt: "Publimetro",               src: `${BASE}/assets/experiencia/publimetro.png?v=4` },
  { alt: "Televisión Nacional",      src: `${BASE}/assets/experiencia/tvn.png?v=4` },
  { alt: "Ministerio de Educación",  src: `${BASE}/assets/experiencia/mineduc.png?v=4` },
  { alt: "INDAP",                    src: `${BASE}/assets/experiencia/indap.png?v=4` },
  { alt: "Subsecretaría de Telecomunicaciones", src: `${BASE}/assets/experiencia/subtel.png?v=4` },
  { alt: "Municipalidad de Cerro Navia",        src: `${BASE}/assets/experiencia/cerro-navia.png?v=4` },
];
---

<section id="experiencia" class="section section--tight-top" data-fade>
  <div class="container">
    <h2 class="h2" style="margin-bottom:1rem;">Experiencia</h2>

    <div class="exp-carousel">
      <button class="exp-btn prev" aria-label="Anterior" id="expPrev">‹</button>

      <div class="exp-track" id="expTrack">
        {logos.map((logo) => (
          <div class="logo-card" title={logo.alt}>
            <img
              class="exp-logo"
              src={logo.src}
              alt={logo.alt}
              loading="lazy"
              decoding="async"
            />
          </div>
        ))}
      </div>

      <button class="exp-btn next" aria-label="Siguiente" id="expNext">›</button>
    </div>
  </div>

  <script is:inline>
    (function(){
      // Fade-in muy temprano
      const section = document.currentScript.closest('section');
      const TRIGGER_OFFSET = 10; // ~inmediato
      function onScroll(){
        const y = window.scrollY || document.documentElement.scrollTop || 0;
        const top = section.offsetTop;
        if (y + window.innerHeight > top + TRIGGER_OFFSET) {
          section.classList.add('fade-in--visible','revealed','reveal--in');
          window.removeEventListener('scroll', onScroll);
        }
      }
      onScroll();
      window.addEventListener('scroll', onScroll, { passive:true });

      // Carrusel simple
      const track = document.getElementById('expTrack');
      const prev  = document.getElementById('expPrev');
      const next  = document.getElementById('expNext');

      const step = () => Math.min( Math.max(track.clientWidth * 0.6, 320), 560 );

      prev.addEventListener('click', () => track.scrollBy({ left: -step(), behavior:'smooth' }));
      next.addEventListener('click', () => track.scrollBy({ left:  step(), behavior:'smooth' }));

      // Arrastre con mouse/touch (opcional)
      let down = false, startX = 0, startScroll = 0;
      track.addEventListener('pointerdown', (e)=>{
        down = true; startX = e.clientX; startScroll = track.scrollLeft; track.setPointerCapture(e.pointerId);
      });
      track.addEventListener('pointermove', (e)=>{
        if(!down) return;
        track.scrollLeft = startScroll - (e.clientX - startX);
      });
      track.addEventListener('pointerup', ()=>{ down = false; });
      track.addEventListener('pointercancel', ()=>{ down = false; });
    })();
  </script>
</section>

<style>
  /* Contenedor del carrusel */
  .exp-carousel{
    position:relative;
    margin-top: .75rem;
  }

  /* Pista horizontal: oculta scrollbar, centrada */
  .exp-track{
    display:flex; gap:1rem;
    overflow-x:auto; scroll-snap-type: x mandatory;
    padding: .75rem 2.5rem .25rem; /* deja espacio para los botones */
    scrollbar-width: none;
  }
  .exp-track::-webkit-scrollbar{ display:none; }

  /* Cada celda tiene caja uniforme para alinear logos */
  .logo-card{
    flex: 0 0 240px;        /* ancho célula */
    height: 120px;          /* alto célula uniforme */
    border-radius: 14px;
    background: #161a20;
    border: 1px solid #222a35;
    display: grid; place-items: center;
    scroll-snap-align: center;
    transition: transform .2s ease, box-shadow .2s ease;
    box-shadow: 0 6px 20px rgba(0,0,0,.35);
  }
  .logo-card:hover{
    transform: translateY(-2px);
    box-shadow: 0 12px 28px rgba(0,0,0,.5);
  }

  /* Logo: grande, manteniendo proporciones */
  .exp-logo{
    max-width: 84%;    /* que no toque bordes */
    max-height: 80%;   /* controla altura visual */
    object-fit: contain;
    display:block;
  }

  /* Botones */
  .exp-btn{
    position:absolute; top:50%; transform:translateY(-50%);
    border:1px solid #222a35; background:rgba(15,23,42,.75); color:#e2e8f0;
    width:40px; height:40px; border-radius:999px; display:grid; place-items:center;
    cursor:pointer; backdrop-filter: blur(6px);
  }
  .exp-btn:hover{ filter: brightness(1.12); }
  .exp-btn.prev{ left: .25rem; }
  .exp-btn.next{ right:.25rem; }

  /* Responsivo: ajusta caja y tamaño visual */
  @media (max-width: 980px){
    .logo-card{ flex-basis: 210px; height:110px; }
  }
  @media (max-width: 640px){
    .logo-card{ flex-basis: 180px; height:100px; }
    .exp-btn{ width:36px; height:36px; }
  }
</style>