---
/** Carrusel de Experiencia (solo logos grandes, sin nombres) */
const BASE = (import.meta.env.BASE_URL || "/").replace(/\/+$/, "");
const srcFor = (p?: string) => (p ? `${BASE}${p.startsWith("/") ? p : `/${p}`}` : "");

const items = [
  { logo: "/assets/experiencia/latercera.png", url: "https://www.latercera.com/" },
  { logo: "/assets/experiencia/tvn.png", url: "https://www.tvn.cl/" },
  { logo: "/assets/experiencia/mineduc.png", url: "https://www.mineduc.cl/" },
  { logo: "/assets/experiencia/indap.png", url: "https://www.indap.gob.cl/" },
  { logo: "/assets/experiencia/subtel.png", url: "https://www.subtel.gob.cl/" },
  { logo: "/assets/experiencia/cerro-navia.png", url: "https://www.cerronavia.cl/" },
  { logo: "/assets/experiencia/publimetro.png", url: "https://www.publimetro.cl/" }
];
---

<section id="experiencia" class="section section--tight-top" aria-labelledby="exp-title">
  <div class="container">
    <h2 id="exp-title" class="h2">Experiencia</h2>

    <div class="exp-carousel">
      <button class="exp-btn prev" type="button" aria-label="Anterior">‹</button>
      <div class="exp-track-wrap">
        <div class="exp-track">
          {items.map((it) => {
            const src = srcFor(it.logo);
            return (
              <a class="exp-item stage-item" href={it.url} target="_blank" rel="noopener">
                <img src={src} alt="" loading="lazy" class="exp-logo" />
              </a>
            );
          })}
        </div>
      </div>
      <button class="exp-btn next" type="button" aria-label="Siguiente">›</button>
    </div>
  </div>

  <script is:inline>
    (function(){
      const section = document.currentScript.closest('section');
      const items = section.querySelectorAll('.stage-item');
      const TRIGGER_OFFSET = 10;
      function onScroll(){
        const y = window.scrollY || document.documentElement.scrollTop || 0;
        const top = section.offsetTop;
        if (y + window.innerHeight > top + TRIGGER_OFFSET) {
          items.forEach(el => el.classList.add('is-on'));
          window.removeEventListener('scroll', onScroll);
        }
      }
      onScroll();
      window.addEventListener('scroll', onScroll, { passive:true });
    })();

    (function(){
      const root = document.currentScript.closest('.exp-carousel');
      const track = root.querySelector('.exp-track');
      const prev = root.querySelector('.prev');
      const next = root.querySelector('.next');
      function stepWidth(){
        const item = track.querySelector('.exp-item');
        return item ? (item.getBoundingClientRect().width + 24) : 320;
      }
      prev.addEventListener('click', ()=> track.scrollBy({ left: -stepWidth(), behavior: 'smooth' }));
      next.addEventListener('click', ()=> track.scrollBy({ left: +stepWidth(), behavior: 'smooth' }));
    })();
  </script>
</section>

<style>
  .exp-carousel{
    position:relative;
    background:linear-gradient(180deg,#0f1216 0%,#13161a 100%);
    border:1px solid #222;
    border-radius:16px;
    padding:2rem 3rem;
    box-shadow:0 8px 28px rgba(0,0,0,.5);
  }

  .exp-track-wrap{ overflow:hidden }
  .exp-track{
    display:flex; gap:1.5rem;
    overflow-x:auto; scroll-snap-type:x proximity;
    padding:1rem 0 1.5rem;
    scrollbar-width:none;
  }
  .exp-track::-webkit-scrollbar{ display:none }

  .exp-item{
    flex:0 0 min(240px, 28vw);
    scroll-snap-align:center;
    display:grid; place-items:center;
    opacity:0; transform:translateY(10px);
    transition:opacity .4s ease, transform .4s ease;
  }
  .exp-item.is-on{ opacity:1; transform:none }

  .exp-logo{
    max-width: 220px;
    max-height: 100px;
    object-fit: contain;
    filter: none !important;
    transition: transform .25s ease;
  }
  .exp-logo:hover{
    transform: scale(1.06);
  }

  .exp-btn{
    position:absolute; top:50%; transform:translateY(-50%);
    border:1px solid #222; background:rgba(17,24,39,.75); color:#e5e7eb;
    width:40px; height:40px; border-radius:999px; display:grid; place-items:center;
    cursor:pointer; backdrop-filter:blur(6px);
  }
  .exp-btn:hover{ filter:brightness(1.1) }
  .exp-btn.prev{ left:.75rem }
  .exp-btn.next{ right:.75rem }

  @media (max-width:680px){
    .exp-logo{ max-width:180px; max-height:80px }
    .exp-item{ flex:0 0 200px; }
  }
</style>